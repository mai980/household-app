{% extends "base.html" %}
{% block title %}ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ â€” ã‚«ãƒƒãƒ—ãƒ«å®¶è¨ˆç°¿{% endblock %}

{% block content %}
<h1 class="page-title">
  <i class="bi bi-speedometer2"></i> ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰
</h1>

<!-- ==============================
     æ¸…ç®—ã‚«ãƒ¼ãƒ‰
     ============================== -->
<div class="card balance-card mb-4
     {% if balance.value > 0 %}balance-positive
     {% elif balance.value < 0 %}balance-negative
     {% else %}balance-zero{% endif %}">
  <div class="card-body text-center">
    <h5 class="card-subtitle mb-2">ç¾åœ¨ã®æ¸…ç®—çŠ¶æ³</h5>

    {% if balance.value > 0 %}
    <div class="balance-amount">
      <i class="bi bi-arrow-right-circle"></i>
      Â¥{{ "{:,}".format(balance.abs_value) }}
    </div>
    <p class="balance-description">
      <strong>{{ balance.user_b }}</strong> ã•ã‚“ãŒ
      <strong>{{ balance.user_a }}</strong> ã•ã‚“ã«æ”¯æ‰•ã†å¿…è¦ãŒã‚ã‚Šã¾ã™
    </p>
    {% elif balance.value < 0 %} <div class="balance-amount">
      <i class="bi bi-arrow-right-circle"></i>
      Â¥{{ "{:,}".format(balance.abs_value) }}
  </div>
  <p class="balance-description">
    <strong>{{ balance.user_a }}</strong> ã•ã‚“ãŒ
    <strong>{{ balance.user_b }}</strong> ã•ã‚“ã«æ”¯æ‰•ã†å¿…è¦ãŒã‚ã‚Šã¾ã™
  </p>
  {% else %}
  <div class="balance-amount">
    <i class="bi bi-check-circle"></i> Â¥0
  </div>
  <p class="balance-description">æ¸…ç®—ä¸è¦ã§ã™ ğŸ‰</p>
  {% endif %}
</div>
</div>

<!-- ==============================
     å†…è¨³ã‚«ãƒ¼ãƒ‰
     ============================== -->
<div class="row g-3 mb-4">
  <div class="col-6">
    <div class="card stat-card">
      <div class="card-body text-center">
        <div class="stat-label">{{ balance.user_a }} ã®ç«‹æ›¿</div>
        <div class="stat-value text-primary">
          Â¥{{ "{:,}".format(balance.a_total) }}
        </div>
        <small class="text-muted">
          ç›¸æ‰‹ç”¨ Â¥{{ "{:,}".format(balance.a_paid_for_b) }}<br>
          å‰²å‹˜åŠé¡ Â¥{{ "{:,}".format(balance.a_split_half) }}
        </small>
      </div>
    </div>
  </div>
  <div class="col-6">
    <div class="card stat-card">
      <div class="card-body text-center">
        <div class="stat-label">{{ balance.user_b }} ã®ç«‹æ›¿</div>
        <div class="stat-value text-info">
          Â¥{{ "{:,}".format(balance.b_total) }}
        </div>
        <small class="text-muted">
          ç›¸æ‰‹ç”¨ Â¥{{ "{:,}".format(balance.b_paid_for_a) }}<br>
          å‰²å‹˜åŠé¡ Â¥{{ "{:,}".format(balance.b_split_half) }}
        </small>
      </div>
    </div>
  </div>
</div>

<!-- ==============================
     ä»Šæœˆã‚µãƒãƒª & ã‚«ãƒ†ã‚´ãƒªåˆ¥
     ============================== -->
<div class="row g-3 mb-4">
  <!-- ä»Šæœˆã‚µãƒãƒª -->
  <div class="col-12 col-md-6">
    <div class="card">
      <div class="card-header">
        <i class="bi bi-calendar3"></i> {{ monthly_summary.month }} ã®æ”¯å‡º
      </div>
      <div class="card-body text-center">
        <div class="stat-value">
          Â¥{{ "{:,}".format(monthly_summary.total) }}
        </div>
        <small class="text-muted">{{ monthly_summary.count }} ä»¶</small>
      </div>
    </div>
  </div>
  <!-- ã‚«ãƒ†ã‚´ãƒªåˆ¥ -->
  <div class="col-12 col-md-6">
    <div class="card">
      <div class="card-header">
        <i class="bi bi-pie-chart"></i> ã‚«ãƒ†ã‚´ãƒªåˆ¥æ”¯å‡º
      </div>
      <ul class="list-group list-group-flush">
        {% for label, amount in category_summary[:5] %}
        <li class="list-group-item d-flex justify-content-between align-items-center">
          {{ label }}
          <span class="badge bg-primary rounded-pill">Â¥{{ "{:,}".format(amount) }}</span>
        </li>
        {% endfor %}
        {% if not category_summary %}
        <li class="list-group-item text-muted text-center">ãƒ‡ãƒ¼ã‚¿ãªã—</li>
        {% endif %}
      </ul>
    </div>
  </div>
</div>

<!-- ==============================
     ç›´è¿‘ã®å–å¼•
     ============================== -->
<div class="card mb-4">
  <div class="card-header d-flex justify-content-between align-items-center">
    <span><i class="bi bi-clock-history"></i> ç›´è¿‘ã®å–å¼•</span>
    <a href="{{ url_for('history') }}" class="btn btn-sm btn-outline-primary">
      ã™ã¹ã¦è¦‹ã‚‹ <i class="bi bi-arrow-right"></i>
    </a>
  </div>
  <div class="list-group list-group-flush">
    {% for txn in recent %}
    <div class="list-group-item">
      <div class="d-flex justify-content-between align-items-start">
        <div>
          <strong>{{ txn.title }}</strong>
          <span class="badge bg-secondary ms-1">{{ txn.payment_type_label }}</span>
          <br>
          <small class="text-muted">
            {{ txn.date.strftime('%m/%d') }} Â· {{ txn.category_label }} Â· {{ txn.payer }}
          </small>
        </div>
        <span class="fw-bold">Â¥{{ "{:,}".format(txn.amount) }}</span>
      </div>
    </div>
    {% endfor %}
    {% if not recent %}
    <div class="list-group-item text-muted text-center py-4">
      ã¾ã å–å¼•ãŒã‚ã‚Šã¾ã›ã‚“ã€‚
      <a href="{{ url_for('add_transaction') }}">æœ€åˆã®æ”¯å‡ºã‚’ç™»éŒ²ã—ã¾ã—ã‚‡ã†ï¼</a>
    </div>
    {% endif %}
  </div>
</div>

<!-- ã‚¯ã‚¤ãƒƒã‚¯ç™»éŒ²ãƒœã‚¿ãƒ³ (FAB) -->
<a href="{{ url_for('add_transaction') }}" class="fab-button" title="æ”¯å‡ºã‚’ç™»éŒ²">
  <i class="bi bi-plus-lg"></i>
</a>
{% endblock %}